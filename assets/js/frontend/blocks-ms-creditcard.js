(()=>{"use strict";const e=window.React,t=window.wc.wcSettings,c=window.wp.htmlEntities,n=window.wc.wcBlocksRegistry,a=window.wp.element,o=(window.wp.i18n,()=>{if("undefined"!=typeof window&&window.moneyspaceConfig&&"production"===window.moneyspaceConfig.environment){if("undefined"!=typeof window&&window.moneyspaceConfig&&(!0===window.moneyspaceConfig.userCanDebug||!0===window.moneyspaceConfig.isAdmin))return"undefined"!=typeof window&&!0===window.moneyspaceDebug||"undefined"!=typeof window&&"true"===localStorage.getItem("moneyspace_debug");const e=new URLSearchParams(window.location.search).get("debug_token"),t="undefined"!=typeof window&&window.moneyspaceConfig&&window.moneyspaceConfig.debugToken||"";return!(!e||!t||e!==t)}return"undefined"!=typeof window&&window.location.search.includes("debug=1")||"undefined"!=typeof window&&!0===window.moneyspaceDebug||"undefined"!=typeof process&&!1||"undefined"!=typeof window&&"true"===localStorage.getItem("moneyspace_debug")}),r=(e,t=null)=>{o()&&(null!==t?console.log(`[MoneySpace] ${e}`,t):console.log(`[MoneySpace] ${e}`))},i=(e,t=null)=>{const c=o()?"[MoneySpace Error] ":"";null!==t?console.error(`${c}${e}`,t):console.error(`${c}${e}`)},d=t=>{const c={ccNo:"",ccName:"",ccExpMonth:"",ccExpYear:"",ccCVV:"",cardYear:"",minCardYear:(new Date).getFullYear(),dirty:!1},[n,d]=(0,a.useState)(c),[l,s]=(0,a.useState)({}),{eventRegistration:m={},i18n:p={}}=t,{onPaymentSetup:u,onCheckoutValidation:C}=m,y=()=>{const e=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked');if(e){const t="moneyspace_creditcard"===e.value||"moneyspace"===e.value;return r("Payment method selection check via radio:",`${e.value} -> selected: ${t}`),t}const t=document.getElementById("radio-control-wc-payment-method-options-moneyspace_creditcard");if(t&&t.checked)return r("Payment method selection check via direct ID -> selected: true"),!0;const c=document.getElementById("radio-control-wc-payment-method-options-moneyspace");return c&&c.checked?(r("Payment method selection check via legacy ID -> selected: true"),!0):(((e,t=null)=>{o()&&(null!==t?console.warn(`[MoneySpace] ${e}`,t):console.warn(`[MoneySpace] ${e}`))})("Could not determine if credit card payment method is selected"),!1)},E=(0,a.useCallback)((()=>{const e={};if(!y())return{};const t=n.ccNo.replaceAll(" ","");if(t?t.length<16?e.ccNo=p.MNS_CC_WARN_CC_NO_2||"Card number must be 16 digits":/^\d{16}$/.test(t)||(e.ccNo="Card number must contain only digits"):e.ccNo=p.MNS_CC_WARN_CC_NO_1||"Card number is required",n.ccName.trim()?n.ccName.trim().length<2&&(e.ccName="Cardholder name must be at least 2 characters"):e.ccName=p.MNS_CC_WARN_CC_NAME||"Cardholder name is required",n.ccExpMonth){const t=parseInt(n.ccExpMonth);(t<1||t>12)&&(e.ccExpMonth="Please select a valid month")}else e.ccExpMonth=p.MNS_CC_WARN_CC_EXP_MONTH||"Expiry month is required";if(n.ccExpYear){const t=(new Date).getFullYear();parseInt(n.ccExpYear)<t&&(e.ccExpYear="Card has expired")}else e.ccExpYear=p.MNS_CC_WARN_CC_EXP_YEAR||"Expiry year is required";if(n.ccExpMonth&&n.ccExpYear){const t=new Date,c=t.getFullYear(),a=t.getMonth()+1,o=parseInt(n.ccExpYear),r=parseInt(n.ccExpMonth);o===c&&r<a&&(e.ccExpMonth="Card has expired")}return n.ccCVV?3!==n.ccCVV.length?e.ccCVV=p.MNS_CC_WARN_CVV_2||"CVV must be exactly 3 digits":/^\d{3}$/.test(n.ccCVV)||(e.ccCVV="CVV must contain only digits"):e.ccCVV=p.MNS_CC_WARN_CVV_1||"CVV is required",e}),[n,p]);(0,a.useEffect)((()=>{if(n.dirty){const e=E();s(e),y()&&Object.keys(e).length>0&&r("Credit Card Form Validation Errors:",e)}}),[n,E]),(({formData:e,onPaymentSetup:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>e))}),[e,t])})({formData:n,onPaymentSetup:u}),(({formData:e,onPaymentSetup:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>({type:"success",meta:{paymentMethodData:{cardNumber:e.ccNo.replaceAll(" ",""),cardHolder:e.ccName,cardExpDate:e.ccExpMonth,cardExpDateYear:e.ccExpYear,cardCVV:e.ccCVV}},paymentMethodData:{cardNumber:e.ccNo.replaceAll(" ",""),cardHolder:e.ccName,cardExpDate:e.ccExpMonth,cardExpDateYear:e.ccExpYear,cardCVV:e.ccCVV}})))}),[e,t])})({formData:n,onPaymentSetup:u}),(({formData:e,onCheckoutValidation:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>{if(!y())return r("Credit Card validation skipped - payment method not selected"),!0;r("Credit Card validation running - payment method IS selected"),e.dirty||d((e=>({...e,dirty:!0})));const t=E();if(r("Credit Card validation errors:",t),Object.keys(t).length>0){s(t);const e=Object.values(t)[0];return i("Credit Card Validation Failed - BLOCKING CHECKOUT:",e),r("Full validation errors:",t),{type:"error",message:e,hidden:!1}}return r("Credit Card Validation Passed - allowing checkout"),!0}))}),[e,t,E])})({formData:n,onCheckoutValidation:C}),(0,a.useEffect)((()=>{const e=e=>{r("Payment method changed:",e.target.value)},t=(()=>{const t=document.querySelectorAll('input[name="radio-control-wc-payment-method-options"]');return t.forEach((t=>{t.addEventListener("change",e)})),t})(),c=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked');return c&&"moneyspace"!==c.value&&setTimeout((()=>{try{r("Hiding validation notices...");const e=document.querySelectorAll([".wc-block-components-notice-banner",".wc-block-components-validation-error"].join(", "));e.forEach((e=>{e&&e.style&&(e.style.display="none",e.setAttribute("aria-hidden","true"))})),r(`Hidden ${e.length} notices`)}catch(e){i("Error hiding notices:",e.message)}}),100),()=>{t.forEach((t=>{t.removeEventListener("change",e)}))}}),[]);const h=e=>n.dirty&&l[e]?"has-error":"",w=t=>n.dirty&&l[t]?(0,e.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,e.createElement)("p",null,l[t])):null,g=[1,2,3,4,5,6,7,8,9,10,11,12],f=e=>t=>{let c=t.target.value;"ccNo"===e?/^[0-9\s]*$/.test(c)&&(c=(e=>{const t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),c=t&&t[0]||"",n=[];for(let e=0,t=c.length;e<t;e+=4)n.push(c.substring(e,e+4));return n.length?n.join(" "):e})(c),d((t=>({...t,[e]:c,dirty:!0})))):"ccName"===e?(c=c.toUpperCase().replace(/[^A-Z\s]/g,""),d((t=>({...t,[e]:c,dirty:!0})))):"ccCVV"===e?/^[0-9]*$/.test(c)&&c.length<=4&&d((t=>({...t,[e]:c,dirty:!0}))):d((t=>({...t,[e]:c,dirty:!0})))};return(0,e.createElement)("div",{className:"wc-block-components-credit-card-form"},(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${h("ccNo")}`},(0,e.createElement)("input",{type:"text",value:n.ccNo,onChange:f("ccNo"),id:"txtCardNumber",name:"cardNumber",onKeyDown:e=>/^[0-9]*$/.test(e.key)||[8,67,86,88].includes(e.keyCode)?n.ccNo.replaceAll(" ","").length>=16&&![8,67,86,88].includes(e.keyCode)?e.preventDefault():void 0:e.preventDefault(),placeholder:"0000 0000 0000 0000",maxLength:"19"}),(0,e.createElement)("label",{htmlFor:"txtCardNumber"},p.MNS_CC_NO," *"),w("ccNo")),(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${h("ccName")}`},(0,e.createElement)("input",{type:"text",value:n.ccName,onChange:f("ccName"),id:"txtHolder",name:"cardHolder",placeholder:"TONY ELSDEN",maxLength:"50"}),(0,e.createElement)("label",{htmlFor:"txtHolder"},p.MNS_CC_NAME," *"),w("ccName")),(0,e.createElement)("div",{className:`wc-block-components-text-input is-active ${h("ccExpMonth")}`},(0,e.createElement)("select",{value:n.ccExpMonth,onChange:f("ccExpMonth"),id:"txtExpDate",name:"cardExpDate"},(0,e.createElement)("option",{value:"",disabled:!0},p.MNS_MONTH),g.map((t=>(0,e.createElement)("option",{key:t,value:t,disabled:t<(n.ccExpYear&&parseInt(n.ccExpYear)===n.minCardYear?(new Date).getMonth()+1:1)},t<10?"0"+t:t)))),(0,e.createElement)("label",{htmlFor:"txtExpDate"},p.MNS_CC_EXP_MONTH," *"),w("ccExpMonth")),(0,e.createElement)("div",{className:`wc-block-components-text-input is-active ${h("ccExpYear")}`},(0,e.createElement)("select",{value:n.ccExpYear,onChange:f("ccExpYear"),id:"ccExpYear",name:"cardExpDateYear"},(0,e.createElement)("option",{value:"",disabled:!0},p.MNS_YEAR),g.map(((t,c)=>(0,e.createElement)("option",{key:c,value:c+n.minCardYear},c+n.minCardYear)))),(0,e.createElement)("label",{htmlFor:"ccExpYear"},p.MNS_CC_EXP_YEAR," *"),w("ccExpYear")),(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${h("ccCVV")}`},(0,e.createElement)("input",{type:"password",value:n.ccCVV,onChange:f("ccCVV"),id:"txtCVV",name:"cardCVV",maxLength:"3",onKeyDown:e=>/^[0-9]*$/.test(e.key)||[8,67,86,88].includes(e.keyCode)?n.ccCVV.length>=3&&![8,67,86,88].includes(e.keyCode)?e.preventDefault():void 0:e.preventDefault(),placeholder:"000",required:0===n.ccCVV.length&&y()}),(0,e.createElement)("label",{htmlFor:"txtCVV"},p.MNS_CC_CVV," *"),w("ccCVV")))},l="moneyspace",s=(0,t.getSetting)(`${l}_data`,{}),m=(0,c.decodeEntities)(s.title),p=s.ms_template_payment,u=t=>{const n=(0,a.useMemo)((()=>({i18n:s.i18n,...t})),[t]);return 1==p?(0,e.createElement)(d,{...n}):(0,c.decodeEntities)(s.description||"")},C={name:l,label:m,content:(0,e.createElement)(u,null),edit:(0,e.createElement)(u,null),ariaLabel:m,paymentMethodId:l,canMakePayment:()=>!0,supports:{features:s.supports}};(0,n.registerPaymentMethod)(C)})();