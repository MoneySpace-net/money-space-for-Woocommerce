(()=>{"use strict";const e=window.React,t=window.wc.wcSettings,c=window.wp.htmlEntities,n=window.wc.wcBlocksRegistry,a=window.wp.element,o=(window.wp.i18n,t=>{const c={ccNo:"",ccName:"",ccExpMonth:"",ccExpYear:"",ccCVV:"",cardYear:"",minCardYear:(new Date).getFullYear(),dirty:!1},[n,o]=(0,a.useState)(c),[r,l]=(0,a.useState)({}),{eventRegistration:i={},i18n:d={}}=t,{onPaymentSetup:s,onCheckoutValidation:m}=i,p=()=>{const e=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked');if(e){const t="moneyspace_creditcard"===e.value||"moneyspace"===e.value;return console.log("Payment method selection check via radio:",e.value,"-> selected:",t),t}const t=document.getElementById("radio-control-wc-payment-method-options-moneyspace_creditcard");if(t&&t.checked)return console.log("Payment method selection check via direct ID -> selected: true"),!0;const c=document.getElementById("radio-control-wc-payment-method-options-moneyspace");return c&&c.checked?(console.log("Payment method selection check via legacy ID -> selected: true"),!0):(console.log("⚠️ Warning: Could not determine if credit card payment method is selected"),!1)},u=(0,a.useCallback)((()=>{const e={};if(!p())return{};const t=n.ccNo.replaceAll(" ","");if(t?t.length<16?e.ccNo=d.MNS_CC_WARN_CC_NO_2||"Card number must be 16 digits":/^\d{16}$/.test(t)||(e.ccNo="Card number must contain only digits"):e.ccNo=d.MNS_CC_WARN_CC_NO_1||"Card number is required",n.ccName.trim()?n.ccName.trim().length<2&&(e.ccName="Cardholder name must be at least 2 characters"):e.ccName=d.MNS_CC_WARN_CC_NAME||"Cardholder name is required",n.ccExpMonth){const t=parseInt(n.ccExpMonth);(t<1||t>12)&&(e.ccExpMonth="Please select a valid month")}else e.ccExpMonth=d.MNS_CC_WARN_CC_EXP_MONTH||"Expiry month is required";if(n.ccExpYear){const t=(new Date).getFullYear();parseInt(n.ccExpYear)<t&&(e.ccExpYear="Card has expired")}else e.ccExpYear=d.MNS_CC_WARN_CC_EXP_YEAR||"Expiry year is required";if(n.ccExpMonth&&n.ccExpYear){const t=new Date,c=t.getFullYear(),a=t.getMonth()+1,o=parseInt(n.ccExpYear),r=parseInt(n.ccExpMonth);o===c&&r<a&&(e.ccExpMonth="Card has expired")}return n.ccCVV?n.ccCVV.length<3?e.ccCVV=d.MNS_CC_WARN_CVV_2||"CVV must be 3 digits":/^\d{3,4}$/.test(n.ccCVV)||(e.ccCVV="CVV must contain only digits"):e.ccCVV=d.MNS_CC_WARN_CVV_1||"CVV is required",e}),[n,d]);(0,a.useEffect)((()=>{if(n.dirty){const e=u();l(e),p()&&Object.keys(e).length>0&&console.log("Credit Card Form Validation Errors:",e)}}),[n,u]),(({formData:e,onPaymentSetup:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>e))}),[e,t])})({formData:n,onPaymentSetup:s}),(({formData:e,onPaymentSetup:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>({type:"success",meta:{paymentMethodData:{cardNumber:e.ccNo.replaceAll(" ",""),cardHolder:e.ccName,cardExpDate:e.ccExpMonth,cardExpDateYear:e.ccExpYear,cardCVV:e.ccCVV}},paymentMethodData:{cardNumber:e.ccNo.replaceAll(" ",""),cardHolder:e.ccName,cardExpDate:e.ccExpMonth,cardExpDateYear:e.ccExpYear,cardCVV:e.ccCVV}})))}),[e,t])})({formData:n,onPaymentSetup:s}),(({formData:e,onCheckoutValidation:t})=>{(0,a.useEffect)((()=>{if(t)return t((()=>{if(!p())return console.log("Credit Card validation skipped - payment method not selected"),!0;console.log("Credit Card validation running - payment method IS selected"),e.dirty||o((e=>({...e,dirty:!0})));const t=u();if(console.log("Credit Card validation errors:",t),Object.keys(t).length>0){l(t);const e=Object.values(t)[0];return console.error("🚨 Credit Card Validation Failed - BLOCKING CHECKOUT:",e),console.error("🚨 Full validation errors:",t),{type:"error",message:e,hidden:!1}}return console.log("✅ Credit Card Validation Passed - allowing checkout"),!0}))}),[e,t,u])})({formData:n,onCheckoutValidation:m}),(0,a.useEffect)((()=>{const e=()=>{try{console.log("Clearing credit card validation notices..."),[".wc-block-components-notice-banner",".wc-block-components-validation-error",".wc-block-components-notices",".woocommerce-error",".woocommerce-message",".woocommerce-info"].forEach((e=>{document.querySelectorAll(e).forEach((e=>{const t=e.textContent||"";(t.includes("installment")||t.includes("3,000")||t.includes("bank")||t.includes("QR"))&&(e.style.display="none",e.setAttribute("aria-hidden","true"),e.classList.add("mns-hidden"))}))}));const e=document.querySelector(".wc-block-components-notices");e&&e.querySelectorAll(".wc-block-components-notice-banner").forEach((e=>{const t=e.textContent||"";(t.includes("installment")||t.includes("3,000")||t.includes("bank"))&&(e.style.display="none",e.setAttribute("aria-hidden","true"))})),console.log("Credit card notices cleared successfully")}catch(e){console.log("Error clearing credit card notices:",e.message)}},t=t=>{console.log("Payment method changed (credit card):",t.target?.value),t.target?.name?.includes("radio-control-wc-payment-method-options")&&(e(),setTimeout((()=>{e(),t.target?.value&&"moneyspace"!==t.target.value&&(o((e=>({...e,dirty:!1}))),l({}))}),100))},c=(()=>{const e=document.querySelectorAll('input[name="radio-control-wc-payment-method-options"]');return e.forEach((e=>{e.addEventListener("change",t)})),e})(),n=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked');return n&&"moneyspace"!==n.value&&setTimeout(e,100),()=>{c.forEach((e=>{e.removeEventListener("change",t)}))}}),[]);const C=e=>n.dirty&&r[e]?"has-error":"",E=t=>n.dirty&&r[t]?(0,e.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,e.createElement)("p",null,r[t])):null,h=[1,2,3,4,5,6,7,8,9,10,11,12],y=e=>t=>{let c=t.target.value;"ccNo"===e?/^[0-9\s]*$/.test(c)&&(c=(e=>{const t=e.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),c=t&&t[0]||"",n=[];for(let e=0,t=c.length;e<t;e+=4)n.push(c.substring(e,e+4));return n.length?n.join(" "):e})(c),o((t=>({...t,[e]:c,dirty:!0})))):"ccName"===e?(c=c.toUpperCase().replace(/[^A-Z\s]/g,""),o((t=>({...t,[e]:c,dirty:!0})))):"ccCVV"===e?/^[0-9]*$/.test(c)&&c.length<=4&&o((t=>({...t,[e]:c,dirty:!0}))):o((t=>({...t,[e]:c,dirty:!0})))};return(0,e.createElement)("div",{className:"wc-block-components-credit-card-form"},(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${C("ccNo")}`},(0,e.createElement)("input",{type:"text",value:n.ccNo,onChange:y("ccNo"),id:"txtCardNumber",name:"cardNumber",onKeyDown:e=>/^[0-9]*$/.test(e.key)||[8,67,86,88].includes(e.keyCode)?n.ccNo.replaceAll(" ","").length>=16&&![8,67,86,88].includes(e.keyCode)?e.preventDefault():void 0:e.preventDefault(),placeholder:"0000 0000 0000 0000",maxLength:"19"}),(0,e.createElement)("label",{htmlFor:"txtCardNumber"},d.MNS_CC_NO," *"),E("ccNo")),(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${C("ccName")}`},(0,e.createElement)("input",{type:"text",value:n.ccName,onChange:y("ccName"),id:"txtHolder",name:"cardHolder",placeholder:"TONY ELSDEN",maxLength:"50"}),(0,e.createElement)("label",{htmlFor:"txtHolder"},d.MNS_CC_NAME," *"),E("ccName")),(0,e.createElement)("div",{className:`wc-block-components-text-input is-active ${C("ccExpMonth")}`},(0,e.createElement)("select",{value:n.ccExpMonth,onChange:y("ccExpMonth"),id:"txtExpDate",name:"cardExpDate"},(0,e.createElement)("option",{value:"",disabled:!0},d.MNS_MONTH),h.map((t=>(0,e.createElement)("option",{key:t,value:t,disabled:t<(n.ccExpYear&&parseInt(n.ccExpYear)===n.minCardYear?(new Date).getMonth()+1:1)},t<10?"0"+t:t)))),(0,e.createElement)("label",{htmlFor:"txtExpDate"},d.MNS_CC_EXP_MONTH," *"),E("ccExpMonth")),(0,e.createElement)("div",{className:`wc-block-components-text-input is-active ${C("ccExpYear")}`},(0,e.createElement)("select",{value:n.ccExpYear,onChange:y("ccExpYear"),id:"ccExpYear",name:"cardExpDateYear"},(0,e.createElement)("option",{value:"",disabled:!0},d.MNS_YEAR),h.map(((t,c)=>(0,e.createElement)("option",{key:c,value:c+n.minCardYear},c+n.minCardYear)))),(0,e.createElement)("label",{htmlFor:"ccExpYear"},d.MNS_CC_EXP_YEAR," *"),E("ccExpYear")),(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-credit-form is-active ${C("ccCVV")}`},(0,e.createElement)("input",{type:"password",value:n.ccCVV,onChange:y("ccCVV"),id:"txtCVV",name:"cardCVV",maxLength:"4",onKeyDown:e=>/^[0-9]*$/.test(e.key)||[8,67,86,88].includes(e.keyCode)?n.ccCVV.length>=4&&![8,67,86,88].includes(e.keyCode)?e.preventDefault():void 0:e.preventDefault(),placeholder:"000",required:0===n.ccCVV.length&&p()}),(0,e.createElement)("label",{htmlFor:"txtCVV"},d.MNS_CC_CVV," *"),E("ccCVV")))}),r="moneyspace",l=(0,t.getSetting)(`${r}_data`,{}),i=(0,c.decodeEntities)(l.title),d=l.ms_template_payment,s=t=>{const n=(0,a.useMemo)((()=>({i18n:l.i18n,...t})),[t]);return 1==d?(0,e.createElement)(o,{...n}):(0,c.decodeEntities)(l.description||"")},m={name:r,label:i,content:(0,e.createElement)(s,null),edit:(0,e.createElement)(s,null),ariaLabel:i,paymentMethodId:r,canMakePayment:()=>!0,supports:{features:l.supports}};(0,n.registerPaymentMethod)(m)})();