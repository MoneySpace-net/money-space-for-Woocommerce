<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneySpace Debug Utility Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
        #console-output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; max-height: 400px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>MoneySpace Debug Utility Test</h1>
    
    <div class="test-section">
        <h2>Debug Mode Status</h2>
        <div id="debug-status" class="status"></div>
        <p>Test different ways to enable debug mode:</p>
        <button onclick="testUrlDebug()">Test URL Debug (?debug=1)</button>
        <button onclick="enableWindowDebug()">Enable window.moneyspaceDebug</button>
        <button onclick="disableDebug()">Disable Debug</button>
    </div>

    <div class="test-section">
        <h2>Debug Logging Test</h2>
        <button onclick="testDebugLog()">Test debugLog()</button>
        <button onclick="testDebugError()">Test debugError()</button>
        <button onclick="testDebugWarn()">Test debugWarn()</button>
        <button onclick="clearConsole()">Clear Console</button>
    </div>

    <div class="test-section">
        <h2>Console Output Monitor</h2>
        <div id="console-output"></div>
    </div>

    <script type="module">
        // Import the debug utility (you'll need to adjust the path)
        // For testing, we'll simulate the debug utility inline
        
        const isDebugMode = () => {
            return (
                (typeof window !== 'undefined' && window.location.search.includes('debug=1')) ||
                (typeof window !== 'undefined' && window.moneyspaceDebug === true) ||
                (typeof process !== 'undefined' && process.env.NODE_ENV === 'development')
            );
        };

        const debugLog = (message, data = null) => {
            if (isDebugMode()) {
                if (data !== null) {
                    console.log(`[MoneySpace] ${message}`, data);
                } else {
                    console.log(`[MoneySpace] ${message}`);
                }
            }
        };

        const debugError = (message, error = null) => {
            const prefix = isDebugMode() ? '[MoneySpace Error] ' : '';
            if (error !== null) {
                console.error(`${prefix}${message}`, error);
            } else {
                console.error(`${prefix}${message}`);
            }
        };

        const debugWarn = (message, data = null) => {
            if (isDebugMode()) {
                if (data !== null) {
                    console.warn(`[MoneySpace] ${message}`, data);
                } else {
                    console.warn(`[MoneySpace] ${message}`);
                }
            }
        };

        // Make functions available globally for testing
        window.debugUtilityTest = {
            isDebugMode,
            debugLog,
            debugError,
            debugWarn
        };

        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const consoleOutput = document.getElementById('console-output');
        
        function appendToConsole(type, message) {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#dc3545' : type === 'warn' ? '#ffc107' : '#28a745';
            div.textContent = `[${type.toUpperCase()}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            appendToConsole('log', args.join(' '));
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            appendToConsole('error', args.join(' '));
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            appendToConsole('warn', args.join(' '));
            originalWarn.apply(console, args);
        };

        // Test functions
        window.testUrlDebug = function() {
            if (!window.location.search.includes('debug=1')) {
                window.location.href = window.location.href + '?debug=1';
            } else {
                updateDebugStatus();
            }
        };

        window.enableWindowDebug = function() {
            window.moneyspaceDebug = true;
            updateDebugStatus();
        };

        window.disableDebug = function() {
            window.moneyspaceDebug = false;
            // Remove URL parameter if present
            if (window.location.search.includes('debug=1')) {
                const url = new URL(window.location);
                url.searchParams.delete('debug');
                window.history.replaceState({}, document.title, url.pathname + url.search);
            }
            updateDebugStatus();
        };

        window.testDebugLog = function() {
            debugLog('Test log message');
            debugLog('Test log with data', { test: 'value', timestamp: new Date().toISOString() });
        };

        window.testDebugError = function() {
            debugError('Test error message');
            debugError('Test error with object', new Error('Sample error'));
        };

        window.testDebugWarn = function() {
            debugWarn('Test warning message');
            debugWarn('Test warning with data', { warning: 'This is a test warning' });
        };

        window.clearConsole = function() {
            consoleOutput.innerHTML = '';
        };

        function updateDebugStatus() {
            const statusEl = document.getElementById('debug-status');
            const isDebug = isDebugMode();
            
            statusEl.className = `status ${isDebug ? 'success' : 'info'}`;
            statusEl.innerHTML = `
                <strong>Debug Mode: ${isDebug ? 'ENABLED' : 'DISABLED'}</strong><br>
                URL Parameter (?debug=1): ${window.location.search.includes('debug=1') ? 'YES' : 'NO'}<br>
                window.moneyspaceDebug: ${window.moneyspaceDebug === true ? 'YES' : 'NO'}
            `;
        }

        // Initial status update
        updateDebugStatus();
        
        // Test that debug is working
        debugLog('Debug utility test page loaded');
        debugLog('Testing debug functionality', { 
            debugMode: isDebugMode(),
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent.substring(0, 50) + '...'
        });
    </script>
</body>
</html>
